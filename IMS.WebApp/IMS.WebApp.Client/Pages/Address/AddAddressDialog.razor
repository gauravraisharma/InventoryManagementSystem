@using IMS.Shared.RequestDto
@using IMS.Shared.Interface.Address
@inject IAddressService AddressService
@inject IDialogService DialogService


<MudContainer MaxWidth="MaxWidth.Large" Class="mt-6">
    <MudDialogContent>
        <MudForm @bind-IsValid="IsValid">
            <MudTextField @bind-Value="Address.City" Label="City" Required="true" />
            <MudTextField @bind-Value="Address.Street" Label="Street" Required="true" />
            <MudTextField @bind-Value="Address.Country" Label="Country" Required="true" />
        </MudForm>
    </MudDialogContent>
    <MudDialogActions>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" Disabled="!IsValid" OnClick="Save">Save</MudButton>
        <MudButton Variant="Variant.Text" Color="Color.Secondary" OnClick="Cancel">Cancel</MudButton>
    </MudDialogActions>
</MudContainer>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }
    [Parameter] public string UserId { get; set; }
    private AddressDTO Address { get; set; } = new();
    private bool IsValid;

    private async Task Save()
    {
        var response = await AddressService.AddAddressAsync(UserId, Address.City, Address.Country, Address.Street);

        if (response.IsSuccess)
        {
            MudDialog.Close(DialogResult.Ok(Address)); 
        }
        else
        {
            await DialogService.ShowMessageBox("Error", response.Message ?? "An error occurred while adding the address.");
        }
    }

    private void Cancel()
    {
        MudDialog.Cancel();
    }
}
